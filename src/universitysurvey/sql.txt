--Creating tables

--Department table
create table Departments (
    depName varchar(25) not null,
    constraint depName_pk primary key (depName)
);

--Course table
create table Courses (
    courseNum int not null,
    depName varchar(25) not null,
    courseName varchar(25) not null,
    courseUnits int not null,
    constraint depName_fk foreign key (depName) references Departments (depName),
    constraint course_pk primary key (courseNum, depName)
);

--Section table
--Figure out how to put in the day
--time is varchar because of am and pm
create table Sections (
    depName varchar(25) not null,
    courseNum int not null,
    secNum int not null,
    startTime varchar(20) not null,
    endTime varchar(20) not null,
    meetingDays varchar(20) not null,
    constraint sectionCourse_fk foreign key (courseNum, depName) references Courses (courseNum, depName),
    constraint section_pk primary key (depName, courseNum, secNum)
);

--Student table
create table Students (
    studentID int not null,
    firstName varchar(25) not null,
    lastName varchar(25) not null,
    email varchar(50) not null,
    constraint student_pk primary key (studentID)
);

--Enrollment table
--Colliding foreign key for enrollmentTeam_fk and enrollmentSec_fk
create table Enrollment( 
    studentID int not null,
    depName varchar(25) not null,
    courseNum int not null,
    secNum int not null,
    teamName varchar(25) not null,
    constraint enrollmentSec_fk foreign key (depName, courseNum, secNum) references Sections (depName, courseNum, secNum),
    constraint enrollmentStudent_fk foreign key (studentID) references Students (studentID),
    constraint enrollmentTeam_fk foreign key (teamName, secNum, depName, courseNum) references Team (teamName, secNum, depName, courseNum),
    constraint enrollment_pk primary key (studentID, depName, courseNum, secNum)
);

--Team table
create table Team(
    teamName varchar(25) not null,
    secNum int not null,
    depName varchar(25) not null,
    courseNum int not null,
    constraint team_fk foreign key (depName, courseNum, secNum) references Sections (depName, courseNum, secNum),
    constraint team_pk primary key (teamName, secNum, depName, courseNum)
);

--Dimension table
--dimension are questions that will be ask on the survey
create table Dimension (
    diName varchar(25) not null,
    secNum int not null,
    depName varchar(25) not null,
    courseNum int not null,
    constraint dimension_fk foreign key (depName, courseNum, secNum) references Sections (depName, courseNum, secNum),
    constraint dimension_pk primary key (diName, secNum, courseNum, depName)
);


--SuveryRating table
--Collision foreign keys between the target and the student doing the survey 
create table SurveyRating (
    ratingTarget int not null,
    studentID int not null,
    secNum int not null,
    depName varchar(25) not null,
    courseNum int not null,
    diName varchar(25) not null,
    rating int not null,
    constraint surveyRatingDi_fk foreign key (diName, secNum, courseNum, depName) references Dimension (diName, secNum, courseNum, depName),
    constraint surveyRatingTarget_fk foreign key (ratingTarget, depName, courseNum, secNum) references Enrollment (studentID, depName, courseNum, secNum),
    constraint surveyRatingStu_fk foreign key (studentID, depName, courseNum, secNum) references Enrollment (studentID, depName, courseNum, secNum),
    constraint surveyRating_pk primary key (diName, ratingTarget, studentID, secNum, depName, courseNum)
);

ALTER TABLE Enrollment
ADD grade varchar(3);

ALTER TABLE Courses
ADD courseDes varchar(100);

ALTER TABLE Sections
ADD instructor varchar(100);

--Insert value into Departments
insert into departments (depname) values
('CECS'),
('Physics'),
('Business');

--Insert value into Courses
insert into Courses (coursenum, depname, coursename, courseunits, coursedes) values
(323, 'CECS', 'Database', 3, 'Database fundamentals using Derby database and mySQL'),
(328, 'CECS', 'Algorithm', 3, 'Basic of algorithms such as sorting, Dijktra, BFS, DFS and so on'),
(151, 'Physics', 'Netownian Physics', 4, 'Speed, velocity, momentum, kinetic energy and more'),
(152, 'Physics', 'Electricity & Magnetism', 4, 'fundametals of electric and magnetic field and circuits');

--Insert into Students
insert into Students (studentID, firstName, lastName, Email) values
(22, 'Teostra', 'Smith', 'Teostra@gmail.com'),
(23, 'Lunastra', 'Snow', 'Lunastra@gmail.com'),
(24, 'Fatalis', 'Dow', 'Fatalis@gmail.com');